==============================================================
Guild: Code4rena
Channel: ARCHIVE-Q4-2023 / panoptic-nov27
==============================================================

[11/22/2023 16:06] knownfactc4_29311 (pinned)
üëã Hello and welcome to the audit channel for the $60,500 USDC **Panoptic** audit!

üìÜ Audit opens 11/27/2023 20:00 (20:00 UTC) and runs through 12/11/2023 20:00 (20:00 UTC) (15 days).

Please give a warm welcome to the Panoptic team, particularly @dyed | Panoptic and @PeakyCryptos | Panoptic, who will be available for questions either here in the channel or via DM in the Eastern timezone.

We'll be posting relevant links, documentation, etc. here, so if you intend to participate in this audit, consider enabling notifications for this channel. üê∫ ‚è∞

Audit Page: https://code4rena.com/contests/2023-11-panoptic

{Reactions}
üëã (8) 

[11/22/2023 16:06] knownfactc4_29311
Pinned a message.


[11/22/2023 16:37] engr.pips
Awesome,  glad to be here


[11/24/2023 07:42] blckhv
Hello, is the OpenZeppelin audit finalized and can it be seen somewhere?


[11/25/2023 22:33] kingx0001
Lfg:dance_vibe:


[11/27/2023 17:17] echospr
Lets go!


[11/27/2023 17:45] squilliamx
is everyone ready to rumble?

{Reactions}
ü´° (7) 

[11/27/2023 18:43] knownfactc4_29311 (pinned)
Since there has been a change in other audit launch times, Panoptic is the only audit launching today. As such it is back to a 1 hour bot race time.

{Reactions}
thankyou (6) 

[11/27/2023 18:44] knownfactc4_29311
Pinned a message.


[11/27/2023 18:46] aboo96.
Lets goo

{Reactions}
üéâ (6) 

[11/27/2023 20:01] 0xgeb
yeaaaaaaaaah buddy


[11/27/2023 20:02] thebrittfactor (pinned)
**4naly3er Report**

The 4naly3er report can be found [here](https://github.com/code-423n4/2023-11-panoptic/blob/main/4naly3er-report.md).

*Note for C4 wardens: The 4naly3er report is ran by our pre-audit Scouts and will be posted at audit launch. This will be in addition to the automated findings (bot report), so anything included in the 4naly3er or the automated findings output (once shared) is considered a publicly known issue and is ineligible for awards.*


[11/27/2023 20:02] thebrittfactor
Pinned a message.


[11/27/2023 21:02] cheatc0d3
Bot registration refused ü•≤


[11/27/2023 22:21] roleengineer
Guys, only briefly looked through your repo, really excited about another idea of uniswap v3 periphery contract, as i'm deep in univ3 contracts i decided to spend my time to try to find smth, idc if openzeppelin found everything already, this one looks really interesting.

{Reactions}
üôÇ (6) 

[11/28/2023 02:25] oceansky
Since abdk audit is already completed, is it ok for sponsor to share the audit report?


[11/28/2023 03:23] j5066
When attempting to execute both the forge build and forge test commands, I encounter this particular option.

{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/Screenshot_from_2023-11-28_07-48-25-9DC62.png


[11/28/2023 05:44] mrosas
@dyed | Panoptic @PeakyCryptos | Panoptic Looked at threads ths


[11/28/2023 07:39] 0xkarl98
hi guys , why i got this after running forge build


[11/28/2023 07:39] 0xkarl98


{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/image-4274F.png


[11/28/2023 07:40] 0xkarl98
i've run forge install before


[11/28/2023 08:12] mrosas
u need to use soldility complier version 0.8.18


[11/28/2023 08:13] mrosas
solc-select install 0.8.18 && solc-select use 0.8.18 will fix the problem


[11/28/2023 08:57] 0xfave
currently having this issue when running `forge test` how can I chabge the rpc

{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/image-FD18C.png


[11/28/2023 09:09] al_qa_qa
I faced the same error msg.


[11/28/2023 09:13] mrosas
Go change in ur env file


[11/28/2023 09:48] 1111eugene
which env file? change what? the repo instruction doesn't mention any env file


[11/28/2023 09:55] jvorex
create a file called .env in the root folder of 2023-11-panoptic


[11/28/2023 10:12] pfapostol
This isn't mentioned because it's not specific to this contest and is a general skill for coding anything.

{Reactions}
ü§£ üíÄ 

[11/28/2023 10:18] 1111eugene
lol


[11/28/2023 10:24] jvorex
generally the file holds everything sensitive your code needs to run and connect to servers etc., so codebases don't provide those on github. instead you should make your own file when you work with the codebase and supply it every variable (in the env file)  the codebase needs to run


[11/28/2023 10:24] jvorex
the file is always sensitive


[11/28/2023 10:25] 0xkarl98
nope it doesn't help


[11/28/2023 10:27] 1111eugene
empty file holds sensitive stuff wow


[11/28/2023 10:27] mrosas
0.8.18


[11/28/2023 10:28] jvorex
ty!


[11/28/2023 10:36] 0xkarl98
not worked


[11/28/2023 10:38] mrosas
can u ss the commands output?


[11/28/2023 10:38] mrosas
Your error states that you are using the wrong compiler version


[11/28/2023 10:38] 0xkarl98


{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/image-E58ED.png


[11/28/2023 10:39] 0xkarl98
yeah i've switched to the version


[11/28/2023 10:39] mrosas
hmm this is weird


[11/28/2023 10:39] mrosas
it should be fixed üòõ


[11/28/2023 10:39] 0xkarl98
lol


[11/28/2023 10:39] mrosas
I wonder if it's cache issue


[11/28/2023 10:39] mrosas
Try rebooting


[11/28/2023 10:40] 0xkarl98
any quick command ?


[11/28/2023 10:40] mrosas
just restart


[11/28/2023 10:40] mrosas
then run forge test


[11/28/2023 10:43] illilli000
`rm -Rf 2023-11-panoptic || true && git clone https://github.com/code-423n4/2023-11-panoptic.git -j8 --recurse-submodules && cd 2023-11-panoptic && nvm install 18.0 && yarn && foundryup && forge build`

{Reactions}
üôå (4) 

[11/28/2023 10:48] 0xkarl98
üòÑ


[11/28/2023 10:55] 0xkarl98
still get the same


[11/28/2023 10:56] 0xkarl98


{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/image-541C4.png


[11/28/2023 10:57] illilli000
it's saying your have forge installed via cargo. can you try running the 'rm' commands it lists, then start from `foundryup` again?


[11/28/2023 14:05] 1111eugene
run forge i
and then forge build


[11/28/2023 15:17] 0xfave
what are the parameters?


[11/28/2023 15:17] 0xfave
I have created the `.env` file


[11/28/2023 15:49] 1111eugene
just a blank file


[11/28/2023 16:18] bugsfinder0x
Hello everyone, what it means legs? and about contracts minted?
@notice Burn a new position containing up to 4 legs wrapped in a ERC1155 token.
/// @param tokenId The tokenId of the minted position, which encodes information about up to 4 legs
/// @param positionSize The number of contracts minted, expressed in terms of the asset


[11/28/2023 16:27] dyedm1
You can manage up to 4 distinct Uniswap positions. Each leg corresponds to a chunk in Uniswap. The number of contracts minted is the amount of token0 or token1 (specified by the asset parameter in the tokenId) on either side of the chunk when it is fully in that token


[11/28/2023 16:38] bugsfinder0x
so if the amount of token0 is 100 the positionSize is 100?


[11/28/2023 16:41] dyedm1
yeah so if there is 100 token0 when current tick is below the lower tick, the positionSize would be 100 and the `asset` parameter would be 0


[11/28/2023 17:23] lsaudit
hey, are reports by other companies (I see OZ and ABDK performed code-review) publicly available? Can I read them somewhere?


[11/28/2023 17:26] cholakovv
https://discord.com/channels/810916927919620096/1176549245935955998/1177514541773508658


[11/28/2023 17:38] banditx0x
`4 legs` provide a stable and efficient means for movement in various environments. In terrestrial settings,  `4 legs` allow for a balance between stability and speed, facilitating activities like running, climbing, or burrowing. The anatomy of `4 leg` vertebrates reflects a balance between structural support and flexibility, crucial for various survival tasks such as hunting, escaping predators, and navigating diverse terrains.

{Reactions}
hearteyesshark 

[11/28/2023 17:39] Message Wolf#0225 (pinned)
**Automated Findings / Publicly Known Issues**

Automated findings output for the audit can be found [here](https://gist.github.com/code423n4/7dcb6a2255ec949b54664c8c8c12b879).

*Note for C4 wardens: Anything included in the automated findings output is considered a publicly known issue and is ineligible for awards.*


[11/28/2023 17:43] plamkata
pin thiz

{Reactions}
ü´° 

[11/28/2023 17:44] 0xsorrynotsorry
Pinned a message.

{Reactions}
thankyou (2) 

[11/28/2023 18:02] lsaudit
ok, so it looks like it's not published üò¶ thank you! Btw, any particular reason of not revealing the OZ's audit report?


[11/28/2023 18:14] dyedm1
It just hasn't been finalized yet

{Reactions}
üëç 

[11/28/2023 19:02] 0xfave
still not working


[11/28/2023 19:24] .ke1cam
navigate to `foundry.toml` file and at line 10 I believe there is a variable `eth_rpc_url`. Change it's value with your own rpc url for example from alchemy. It worked for me

{Reactions}
thankyou (4) 

[11/28/2023 21:24] theschnilch
A publicly known issue states: ‚ÄúSome tokens may not be transferable at all.‚Äù What would be a case where a token is not transferable?


[11/28/2023 21:46] dyedm1
All chunks (a chunk for this purpose is defined by the key (tickLower, tickUpper, tokenType, pool) being transferred to another account have to be unique. So if two accounts have positions with the same chunks, or a position has 2 of the same chunk, the transfer cannot occur.


[11/28/2023 23:37] noahfig.eth
What is the reason for that while loop in `SemiFungiblePositionManager.sol::initializeAMMPool()`?   
```
        while (address(s_poolContext[poolId].pool) != address(0)) {
            poolId = PanopticMath.getFinalPoolId(poolId, token0, token1, fee);
        }
```


[11/28/2023 23:41] dyedm1
To prevent poolId collisions


[11/28/2023 23:48] guy_in0xnito
What does the argument "self" actually represent in functions of TokenId?


[11/29/2023 00:49] fulum
I dm you

{Reactions}
üëç 

[11/29/2023 04:02] dontonka
@dyed | Panoptic sent a FR.

{Reactions}
üëç 

[11/29/2023 04:04] cholakovv
@dyed | Panoptic can you check dm pls?

{Reactions}
üëç 

[11/29/2023 04:19] dyedm1
It's the tokenId you're calling the function on. TokenId is used as a type, so if you do
```
using TokenId for uint256;
uint256 tokenId = ...;
tokenId.function(params);
```
The first argument passed into that function will be the tokenId as self, and then all the other arguments are set to the parameters you specify.
For the `add` functions, the tokenId passed as self would be the one currently under construction, and for the read functions like `strike()`, it would be the tokenId you're reading from.


[11/29/2023 04:45] m_rassska
@dyed | Panoptic, do you prefer dms or private threads?


[11/29/2023 04:52] dyedm1
Threads


[11/29/2023 05:13] mgf15
```The application panicked (crashed).
Message:  byte index 4 is out of bounds of `L()`
Location: crates/evm/src/decode.rs:193
```


[11/29/2023 05:14] mgf15
??


[11/29/2023 05:38] chinmayf
:snooze:  where are the reports


[11/29/2023 08:07] plamkata
Could you guys give a brief explanation on in-the-money options?


[11/29/2023 08:07] plamkata
Like what it means


[11/29/2023 10:44] _polex
@dyed | Panoptic is it possible to DM you or we have to deploy out questions here in threads?


[11/29/2023 13:36] al_qa_qa
When reading the docs, there are some variables and informations that are not presented in the code.

For example `_poolUtilization()` and `totalAssets()` .
https://panoptic.xyz/docs/panoptic-protocol/specs#pool-utilization

I can't find these variables in the codebase. @dyed | Panoptic

{Embed}
https://panoptic.xyz/docs/panoptic-protocol/specs
Panoptic Specs | Panoptic
PanopticPool Balances
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/website-banner-E9E8A.png

{Reactions}
üëç 

[11/29/2023 14:49] un_for_given
where is the liquidation logic?


[11/29/2023 14:53] bugsfinder0x
is there a workflow files to see how correctly interact with code?


[11/29/2023 14:55] plamkata
The test file


[11/29/2023 14:55] bugsfinder0x
i was checking the test file.....is not so clear in my opinion


[11/29/2023 14:57] bugsfinder0x
For example... 
```
function mintTokenizedPosition(
        uint256 tokenId,
        uint128 positionSize,
        int24 slippageTickLimitLow,
        int24 slippageTickLimitHigh
    )
```


[11/29/2023 15:00] bugsfinder0x
Which tokenId is? is minting a new ERC1155 this function.


[11/29/2023 15:14] plamkata


{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/GAHF4otaIAA_gPt-D38D8.png

{Reactions}
üòÇ (15) 

[11/29/2023 15:31] gladita
Go read on the panoptic website about options. You can have options that involve multiple positions such as spreads (buying a call at one price and selling a put at another... that would be 2 legs).


[11/29/2023 15:32] viraz4331
@dyed | Panoptic dm'ed you

{Reactions}
üëç 

[11/29/2023 15:37] dyedm1
No. This function creates liquidity in Uniswap for you and issues an 1155 token to represent it, similar to how the NonFungiblePositionManager issues NFTs to represent liquidity you mint through that position manager.


[11/29/2023 16:40] ding0077
I bet this is the latest version of chatGPT üòÇ

{Reactions}
üòÇ 

[11/29/2023 17:03] 0xsimeon
@dyed | Panoptic  What is in-the-money amounts?


[11/29/2023 17:18] peakycryptos
Started a thread.


[11/29/2023 18:28] engr.pips
Started a thread.


[11/29/2023 23:01] gladita
How will the options be priced? I saw something in the docs that it would be based on fees accrued on uniswap but I don't understand how that would work


[11/30/2023 00:10] dyedm1
(the SFPM is not the entire protocol, it's a Uniswap position manager that it uses)
But yes the options are priced using a streaming premium. Instead of paying the premium up front, buyers borrow liquidity from sellers and pay them the fees accrued plus a certain multiplier based on the utilization of the borrowed liquidity (which is exposed in the SFPM for Panoptic to use)

LPing in Uniswap V3 is analogous to selling options - it has a similar intrinsic payoff and the Uniswap fees function as the premium. To read more about this check out the Panoptic's Genesis blog post series: https://lambert-guillaume.medium.com/ and our WP: https://paper.panoptic.xyz/

{Embed}
https://lambert-guillaume.medium.com/
Guillaume Lambert ‚Äì Medium
Read writing from Guillaume Lambert on Medium. Asst professor in Applied Physics at Cornell. LambertLab.io PI and proud father. Interests: Biophysics, Math, Crypto, and Options (often all at the same time).

{Embed}
https://paper.panoptic.xyz/
Panoptic Whitepaper
The DeFi Options Protocol Whitepaper
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/website-banner-18FF6.png


[11/30/2023 01:01] gladita
does that mean you can theoretically manipulate the price of the options by trading a lot in the uniswap pool


[11/30/2023 01:06] peakycryptos
Sensitive parameters, such as the liquidation threshold, would be determined based on the time-weighted average price. The amount of stremia accrued would be influenced by the trading activity within the specified range in the pool.


[11/30/2023 01:06] gladita
Also let's say that I want to buy a call option on WETH... if I buy it using the WETH/USDC pool instead of the WETH/USDT pool and the former pool has more fees accruing, it would be more expensive even though either way it's a perpetual call option on WETH?


[11/30/2023 02:02] dyedm1
Sure, but those fees are actually paid to LPs, so if the Uniswap pool is liquid at that strike it would cost many times more to accumulate fees on removed liquidity than what you would earn by doing that.
> Also let's say that I want to buy a call option on WETH... if I buy it using the WETH/USDC pool instead of the WETH/USDT pool and the former pool has more fees accruing, it would be more expensive even though either way it's a perpetual call option on WETH?
Yep. If the Uniswap pools were perfectly efficient then the fees per liquidity on that pool would be nearly identical. Since Panoptic allows longing and shorting of LP positions, it may contribute towards making the distribution of liquidity between pools more efficient.


[11/30/2023 07:41] amithuddar
Up to 4 legs: Uniswap V3 introduces the concept of "concentrated liquidity," allowing liquidity providers to concentrate their funds within a specified price range. These ranges are often called "legs," and the statement suggests that this mechanism involves handling positions with up to four legs. Each leg could represent a different price range for a trading pair.

{Reactions}
‚ù§Ô∏è (5) 

[11/30/2023 08:04] plamkata
So basically instead of having 4 erc721's, we have 1 erc1155 with 4 legs encoded into it's token's bits

{Reactions}
üëç (2) 

[11/30/2023 09:54] comradektg
Hi @dyed | Panoptic , can you check your DM?

{Reactions}
üëç 

[11/30/2023 10:20] 0xfave
Yes


[11/30/2023 12:10] engr.pips
How do you mean it's token's  bits ?


[11/30/2023 12:21] plamkata
The token is of type uint256 and they use segments of those bits to store information about the 4 positions and the univ3 pool


[11/30/2023 12:22] plamkata
So they store all of that info into a single uint256 for storage efficiency


[11/30/2023 12:38] sp1cymeatball
@dyed | Panoptic hey! Do users need to encode the tokenId on their own, in order to call SFPM mint function?


[11/30/2023 13:43] pfapostol
there are helpers in tokenid library

{Reactions}
thankyou 

[11/30/2023 14:19] dyedm1
Yes. those helpers (addParam/addLeg) in TokenId.sol make it easier but ultimately that's their or whatever frontend they're using responsibility

{Reactions}
thankyou 

[11/30/2023 14:34] fulum
I just read this very interesting paper for anyone want to know more about Uniswap V3 or remind some concepts


[11/30/2023 14:34] fulum
https://zerocap.com/insights/research-lab/uniswap-v3-capital-efficiency/#:~:text=In%20Uniswap%20V3%2C%20the%20equivalent,position%20is%20‚Äúcalled%20away.‚Äù

{Embed}
Beau Chaseling
https://zerocap.com/insights/research-lab/uniswap-v3-capital-efficiency/
Uniswap V3: Maximising Capital Efficiency
Zerocap's Innovation Analyst Beau Chaseling provides a comprehensive guide on the technology behind Uniswap V3 and its many perks.
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/uniswap-v3-banner-2-D34AC.jpg

{Reactions}
üëçüèΩ (4) 

[11/30/2023 15:01] engr.pips
Awesome


[11/30/2023 15:01] engr.pips
Thanks for sharing

{Reactions}
hi5 

[11/30/2023 16:06] plamkata
liquidity chunks just calculate how much liquidity there is between 2 ticks per leg of a tokenID position right?


[11/30/2023 16:42] nmirchev8
Where we can see Panoptic pool?


[11/30/2023 16:45] engr.pips
Anyone here knows what it means to piggyback a reentrancy lock ?


[11/30/2023 17:40] taylorwebb
where do you see this?


[11/30/2023 17:47] dyedm1
It's not in the scope of this audit. If you want to see it, it's on our public panoptic-v1-core repo

{Reactions}
‚úÖ 

[11/30/2023 17:49] dyedm1
It just means we're storing the reentrancy lock bit in the pool id -> pool address mapping to save gas. 
It's in this struct:
```    struct PoolAddressAndLock {
        IUniswapV3Pool pool;
        bool locked;
    }
```

{Reactions}
üëç 

[11/30/2023 18:12] mgf15
got error when run forge test --gas-report


[11/30/2023 18:13] mgf15


{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/image-3B3CB.png


[11/30/2023 18:29] engr.pips
Thank you so much for the response


[11/30/2023 19:10] cholakovv
yeah, so for what I've understand for each leg of a TokenID position, there is a corresponding LiquidityChunk that keeps track of the liquidity within that leg tick range and after that this information is used to calculate the fees that the position has earned or owed


[11/30/2023 19:11] cholakovv
@dyed | Panoptic have I understanded it well?


[11/30/2023 19:18] gladita
anyone know why the calculation in getAmount0ForLiquidity is different than getAmount1ForLiquidity... the first one is mulDiv96(liquiditychunk.liquidity() >>96, highPriceX96 - lowPriceX96, highPriceX96)/lowPriceX96 while the latter is just mulDiv(liquiditychunk.liquidity(), highPriceX96 - lowPriceX96)


[11/30/2023 19:35] pfapostol
It is uniswap math, read whitepaper or docs


[11/30/2023 19:44] dyedm1
Yep you got it

{Reactions}
‚úÖ 

[11/30/2023 19:47] dyedm1
One is calculating the amount of token0 when the price is to the left of the range, the other is calculating the amount of token1 when the price is to the right of the range. Take a look at: https://uniswapv3book.com/docs/introduction/introduction-to-markets/ if you're interested in learning how those formulas are derived.

{Embed}
https://uniswapv3book.com/docs/introduction/introduction-to-markets/
Introduction to Markets
Introduction to markets #  How centralized exchanges work #  In this book, we‚Äôll build a decentralized exchange (DEX) that will run on Ethereum. There‚Äôre multiple approaches to how an exchange can be designed. All centralized exchanges have an order book at their core. An order book is just a journal that stores all sell and buy orders that trad...


[11/30/2023 21:49] sp1cymeatball
@dyed | Panoptic silly question, how do users get their ERC20 tokens back?


[11/30/2023 21:55] taylorwebb
@dyed | Panoptic what is meant by a leg having a "risk partner"?


[11/30/2023 22:11] aboo96.
+1, no silly question üôã


[11/30/2023 22:28] dyedm1
The caller's address is passed into the `collect` function in Uniswap when burned liquidity/fee tokens are collected and they're sent directly from the Uniswap pool


[11/30/2023 22:29] dyedm1
nothing in the SFPM, but it's an optional feature in Panoptic that can be used to reduce the collateral requirement for certain legs that have a lower overall risk combined

{Reactions}
üôè (3) 

[11/30/2023 22:47] .akira0327
should it be 1, sum of the optionRatios of 4 legs?


[11/30/2023 23:08] taylorwebb
@dyed | Panoptic in the tokenID decoding, how is `(2) asset` different from `(5) tokenType` ?

doesn't whether its a put or a call in `(5) tokenType` technically depend on what `(2) asset` is set to?

{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/image-9E902.png


[11/30/2023 23:28] dyedm1
`asset` determines whether the position is sized in terms of token0 or token1 (i.e how you specify the position size), it has nothing to do with the tokenType

{Reactions}
üëç (2) 

[11/30/2023 23:28] dyedm1
What do you mean?


[11/30/2023 23:29] .akira0327
`uint256 amount = uint256(positionSize) * tokenId.optionRatio(legIndex);`


[11/30/2023 23:29] .akira0327
I guessed from this line.


[11/30/2023 23:31] dyedm1
So what's the question?


[11/30/2023 23:32] .akira0327
I need only your confirmation if my guessing is right or not


[11/30/2023 23:48] dyedm1
Sorry I'm confused. What did you guess?
The sum of the optionRatios don't need to be anything in particular, each leg is sized independently using the overall positionSize with the optionRatio as a multiplier


[11/30/2023 23:50] .akira0327
Let's say token1 have 4 legs, then I guess 
`token1.optionRatio(0)+token1.optionRatio(1)+token1.optionRatio(2)+token1.optionRatio(3) = 1` üôÇ


[11/30/2023 23:53] dyedm1
Nope. That's actually impossible because the optionRatio is an integer lol


[11/30/2023 23:55] .akira0327
Got it. Let me research more.


[11/30/2023 23:55] .akira0327
Just trying to understand the relation between position and its legs.


[12/01/2023 05:39] viraz4331
dm'ed u @dyed | Panoptic


[12/01/2023 11:14] benrai
I think what you are looking for is how the ratios work, right? Lets assume you have two legs and want to invest 9 eth. You have optionRatioLeg1 = 1 and optionRatioLeg2 = 2. This determines that you will invest 1/3 = 3 eth in leg1 and 2/3 in leg2. To calculate this, you take the optionRatio of one leg and divide it through the sum of all optionRatios (1/ (1+2) = 1/3 in our example). Can you confirm this @dyed | Panoptic?


[12/01/2023 12:09] topmark1
pls check private thread @dyed | Panoptic @PeakyCryptos | Panoptic | Panoptic

{Reactions}
‚úÖ 

[12/01/2023 12:26] engr.pips
@dyed | Panoptic  the comment inside of the ```initializeAMMPool ``` function in the SFPM contract state that ```some pool may not be deployable if the poolID has a collision (since we take only 8 bytes) ``` 
What does that mean ?


[12/01/2023 13:13] rouhsamad
i think it says that in some very rare cases two pools might have same address
for example if we have two pools:
pool A : 0xcba0074a77A3aD62------------------
pool B : 0xcba0074a77A3aD62------------------
first 8 bytes (16 hex characters) of two pools are same, hence they will result in same poolId and that means a collision, that means we have to enter that "while" loop and find a different Id


[12/01/2023 13:16] sp1cymeatball
@dyed | Panoptic hi! So if the user wants to open a long position, he first needs to open a short position in this range, or this condition will revert
https://github.com/code-423n4/2023-11-panoptic/blob/main/contracts/SemiFungiblePositionManager.sol#L981-L985 ?


[12/01/2023 13:40] engr.pips
Yeah and that is a case where there is no short position available for that range at which the user wants to trade


[12/01/2023 13:40] engr.pips
Right @dyed | Panoptic


[12/01/2023 13:55] engr.pips
It says in the comment above ```mapping(address univ3pool => uint256 poolIdData) internal s_AddrToPoolIdData``` 
that 
``` pool address => pool id + 2 ** 255 (initialization bit for poolid == 0, set if the pool exists```

does anyone understands why we are adding pool id to 2 ** 25 ?


[12/01/2023 13:59] sp1cymeatball
it will put 1 to the MSB, so we can distinguish poolId = 0 from unitialized mapping

{Reactions}
üëç 

[12/01/2023 14:00] engr.pips
The number keeps increasing in that manner , right ?


[12/01/2023 14:01] engr.pips
I mean for the next pool that would be  created it will add 2


[12/01/2023 14:01] rouhsamad
yea, if (i think in a very rare case again) the poolId is 0
like 
pool Address : 0x000000000000000000------------------
then we flip MSB to 1 which means we know that pool is initialized


[12/01/2023 14:11] engr.pips
In this same spot it says that 
```store the mapping between the poolId and the Uniswap v3 pool - intent is to be 1:1 for all pools``` 

I understand that the mapping stores the address of a pool mapped to its corresponding poolIdData but what do they mean by ```intent is to be 1:1 for all pool```


[12/01/2023 14:11] engr.pips
I am very sorry if I am asking too much questions , just need to be really clear about stuffs


[12/01/2023 14:21] rouhsamad
s_AddrToPoolIdData maps pool address to its Id, i think it simply means that the pointed poolId must yield the same pool address
the pool Id here is 2 * 55 + first 8 bytes of the pool address 
you can think of it as a 1 with 255 zeros, then you are adding the first 8 bytes of the pool address to it
you can also see that getPoolId gets an address and cuts the last 64 bits from its corresponding poolId


[12/01/2023 14:26] engr.pips
PoolId = the currentId + 255 zeros + the first 8 bytes of the pool address , where the current ID increase with every pool initiated , meaning for the first pool it will be 1 for the second pool 2 and so on ?


[12/01/2023 14:26] engr.pips
Am I right ?


[12/01/2023 14:30] sp1cymeatball
Nah, there is no currentId counter, it's just first 64 bits of uni pool address + some random number in very rare cases if there is a collision


[12/01/2023 14:32] engr.pips
So PoolId = first 64 bit of the pool Address + some random number , right ?

{Reactions}
üáæ üá™ üá∏ 

[12/01/2023 14:36] engr.pips
Awesome,  thank you so much @SpicyMeatball , if you won't mind me asking,  how do we get those random numbers is it from an oracle of there is some implementation  that help us in generating the random numbers ?


[12/01/2023 14:36] rouhsamad
2 ** 255 is 
1 + 255 zeroes
each time you initialize a pool you are adding first 64 bits of the pool address to that number
example
pool A: 0xcba0074a77A3aD623A80492Bb1D8d932C62a8bab
s_AddrToPoolIdData[0xcba0074a77A3aD623A80492Bb1D8d932C62a8bab] = 1 + 191 zeroes + cba0074a77A3aD62


[12/01/2023 14:38] rouhsamad
if we didnt add 1 + 255 zeroes to it
lets say that we have a pool address with first 64 bits set to 0, then 
s_AddrToPoolIdData[poolAddress] would be equal to 0
so we are adding a 1 + 255 zeroes to it which means even in this rare case the s_AddrToPoolIdData[poolAddress] will return 2 ^ 255


[12/01/2023 14:38] plamkata
Anybody that understood liquidity pools? I am trynna understand how they increase, does the liquidity parameter of a chunk increase per mint for a specific tokenId>


[12/01/2023 14:38] plamkata
?


[12/01/2023 14:40] engr.pips
Very insightful  @rsam_eth , I can't thank you enough for that explanation!

{Reactions}
üëç 

[12/01/2023 14:40] guy_in0xnito
So here we actually providing liquidity to unv3 via panoptic through ERC1155(self) tokenId as manager which manages their position , so Option traders can buy and sell the assets inuniswap pool for option contracts ,adding legs(4) ,    is this the thing that's going on  ?


[12/01/2023 14:49] engr.pips
```positionKey = keccak256(abi.encodePacked(address poolAddress, address owner, int24 tickLower, int24 tickUpper))``` , correct ?


[12/01/2023 15:23] gladita
If anyone has looked at tokenId.sol, why do we have to % 2 for the portions of the tokenId that are only comprised of 1 bit (eg asset)? asset is only 1 bit.


[12/01/2023 15:24] gladita
When you have 0 or 1 and % 2 you still get the correct thing but I don't see why you would need to


[12/01/2023 15:28] engr.pips
@nocoder  , is this correct ?


[12/01/2023 15:28] engr.pips
@dyed | Panoptic


[12/01/2023 16:39] rouhsamad
Its based on this formula
in bitwise context B % 2^N gives last N bits of B
So its basically extracting the last bit, we do this because other parts of the leg should be ignored


[12/01/2023 16:46] guy_in0xnito
https://github.com/code-423n4/2023-11-panoptic/blob/f75d07c345fd795f907385868c39bafcd6a56624/contracts/SemiFungiblePositionManager.sol#L179

{Embed}
https://github.com/code-423n4/2023-11-panoptic/blob/f75d07c345fd795f907385868c39bafcd6a56624/contracts/SemiFungiblePositionManager.sol
2023-11-panoptic/contracts/SemiFungiblePositionManager.sol at f75d0...
Contribute to code-423n4/2023-11-panoptic development by creating an account on GitHub.
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/715d51c7-f6c4-4ebb-b17f-fa994ee60fc8-E5963


[12/01/2023 16:47] guy_in0xnito
Did anyone understand this code liquidity mapping?


[12/01/2023 18:41] 0xfave
Do you have any resources that can help in understanding bit wise

found this
https://medium.com/@imolfar/bitwise-operations-and-bit-manipulation-in-solidity-ethereum-1751f3d2e216

I am yet to understand it

{Embed}
https://medium.com/@imolfar/bitwise-operations-and-bit-manipulation-in-solidity-ethereum-1751f3d2e216
Bitwise Operations and Bit Manipulation in Solidity, Ethereum
Yes, Ethereum is the world‚Äôs computer, though probably the most expensive one. Since storage is the largest gas-consuming operation‚Ä¶


[12/01/2023 18:47] plamkata
?


[12/01/2023 19:01] lourenslinde
Maybe this will help you a bit, something I wrote a while back. Full article [here](https://app.buidlguidl.com/build/rKQQX7HvCcoVpWCU3qMW)

{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/Screenshot_20231201_205813_Chrome-CA0DD.jpg

{Embed}
https://app.buidlguidl.com/build/rKQQX7HvCcoVpWCU3qMW
Flipping Bits for Fun (and Profit) | BuidlGuidl
An experiment in bit packing in a simple voting dApp.  

The readme contains an explanation of what I learned about bit manipulation and packing in Solidity. 

The build packs a proposal into a record of vote start time, vote end time, votes for, votes against, and an open 16 bit space for extra data. All the aforementioned values are contained ...
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/builds%252Fab32b86505dc3b4890356d600-0074B.jpeg

{Reactions}
10_10 

[12/01/2023 19:02] rouhsamad
I read those on "art of assembly" book
Chapter One explains all the things you need to know

{Reactions}
10_10 (2) 

[12/01/2023 19:02] rouhsamad
Pdf book is free on google


[12/01/2023 19:29] engr.pips
Did i download the correct stuff ?

{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/Screenshot_20231201-202906_Samsung_Notes-CED37.jpg


[12/01/2023 19:30] rouhsamad
Yes


[12/01/2023 19:31] engr.pips
Thanks friend

{Reactions}
üëç 

[12/01/2023 19:31] rouhsamad
It gives you a very strong understanding of binary system,  but ofc you have to practice them a lot


[12/01/2023 19:32] engr.pips
Yeah I get , I will make sure to practice


[12/01/2023 20:10] _killua69_
Did anyone make one of those protocol explaination articles on medium or twitter for panoptic?


[12/01/2023 21:30] fulum
To complete @LokiThe5th  and @rsam_eth If you have time I recommend you to make some tests on Remix with bit, that help me a lot to understand this subject :chefskiss:

{Reactions}
üëç (2) 

[12/02/2023 00:56] taylorwebb
Why are there the token transfer requirements that the entire balance must be sent, and the receiver must have a zero balance?

{Reactions}
‚òùÔ∏è (2) 

[12/02/2023 05:34] 0xfave
thanks


[12/02/2023 05:39] 0xfave
thanks man


[12/02/2023 12:14] sp1cymeatball
@dyed | Panoptic are premia values used outside of the contract? I don't see them being used in SFPM
https://github.com/code-423n4/2023-11-panoptic/blob/main/contracts/SemiFungiblePositionManager.sol#L1083-L1085


[12/02/2023 12:15] gr34t.l4k3
@dyed | Panopticcheck my private thread


[12/02/2023 15:33] sovaslava9
Hello. Who can please explain, what does hex value mean, which we write to memory ?


[12/02/2023 15:33] sovaslava9


{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/telegram-cloud-photo-size-2-54249324070244-CFC9D.jpg


[12/02/2023 15:51] fulum
Read the comment. It never gets run because it's after the return, but it effectively disables a compiler feature and reduces the contract size.


[12/02/2023 15:53] sovaslava9
Yes, but why exatcly this value and no other?


[12/02/2023 15:56] fulum
imo because it's never called, the value is not important, not sure


[12/02/2023 18:51] gladita
does your strike have to be in the exact middle of the two ticks you chose?


[12/02/2023 19:52] rouhsamad
Is it possible to increase the contest time üòÑüòÖ

{Reactions}
ü§ù (6) üòÑ üëÜ (2) 

[12/02/2023 20:26] ustas.eth
Will SFPM tokens be used somewhere outside of the system? Maybe in some other Panoptic products?


[12/02/2023 23:54] gladita
Does anyone know, when a leg is burned and the portion of the tokenid representing that leg is 0ed out, do the remaining leg(s) move within tokenId (like if leg 0 is burned, does leg 1 move over to take its place in tokenid)? Seems to be contemplated in tokenId.sol but don't see where it explicitly happens


[12/03/2023 00:15] olanre_waju
https://github.com/code-423n4/2023-11-panoptic/blob/f75d07c345fd795f907385868c39bafcd6a56624/contracts/SemiFungiblePositionManager.sol#L873-L877 this implies that the legs will be burnt from the last to the first.


[12/03/2023 03:23] minh___
> Implemented using Uniswap's "incorrect" constants

Where can I read more about this? more out of curiosity


[12/03/2023 10:19] pascal9476
Please what exactly are legs


[12/03/2023 10:21] pascal9476
Any body ?
Doesn‚Äôt necessarily have to be the sponsors


[12/03/2023 10:26] audinarey
Co-ask


[12/03/2023 10:30] benrai
@dyed | Panoptic, @PeakyCryptos | Panoptic  please check my private thread

{Reactions}
‚ù§Ô∏è ‚úÖ 

[12/03/2023 10:33] topmark1
it says here that rounding up would make it consistent with Uniswap's..., in what way though ü§î  https://github.com/code-423n4/2023-11-panoptic/blob/main/contracts/libraries/Math.sol#L88

{Embed}
https://github.com/code-423n4/2023-11-panoptic/blob/main/contracts/libraries/Math.sol
2023-11-panoptic/contracts/libraries/Math.sol at main ¬∑ code-423n4/...
Contribute to code-423n4/2023-11-panoptic development by creating an account on GitHub.
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/715d51c7-f6c4-4ebb-b17f-fa994ee60fc8-E5963


[12/03/2023 10:33] topmark1
pls check private thread @dyed | Panoptic @PeakyCryptos | Panoptic | Panoptic | Panoptic

{Reactions}
‚úÖ 

[12/03/2023 11:03] para8956
You compute it. For example in python. For info all these numbers are precomputed sqrt(1/1.0001)^n for all tick base 2 decomposition

```python

from decimal import Decimal, getcontext

#Setting the precision high enough for this calculation
getcontext().prec = 128

#Constants
base = Decimal('1.0001')

#Calculation
sqrt_value = (Decimal(1) / base).sqrt()
result = sqrt_value ** 2 * (2**128)

#Converting the result to hex
hex_result = hex(int(result))
print(hex_result)
```

result being 0xfff97272373d413259a46990580e2139 the result of the true one commented in the code. You can do the following for all components of the decomposition


[12/03/2023 11:06] para8956
So yes not sure how uniswap came with their basis


[12/03/2023 11:07] para8956
I you want to understand more behind the math here is a ressource found in a forum that explain it  https://www.solveforum.com/forums/threads/solved-tickmath-uniswapv3-library-trying-to-understand-getsqrtratioattick-solidity-function-inside.84984/

{Embed}
https://www.solveforum.com/forums/threads/solved-tickmath-uniswapv3-library-trying-to-understand-getsqrtratioattick-solidity-function-inside.84984/
[Solved] TickMath UniswapV3 library. Trying to understand getSqrtRa...
bitcazador Asks: 	TickMath UniswapV3 library. Trying to understand getSqrtRatioAtTick solidity function inside  
Please, I am uncapable of understanding the logic behind getSqrtRatioAtTick function. Is there anyone wise/clever enough for explaining for example this line?

if (absTick & 0x4 != 0)...


[12/03/2023 11:08] para8956
If someone has a better ressource than a forum discussion I'm down ^^


[12/03/2023 11:15] para8956
the 0xfff97272373d413259a46990580e213a of uniswap actually result from using only 39 precision ü§î


[12/03/2023 11:21] para8956
beware that the code given is only (one of the most important) one component of panoptic codebase and you are advise to understand the context. But legs are the components of an option strategies. By combining PUT and CALL options you can create different exposures. Panoptic allows you to create a strategy up to 4 legs. A 1 leg strategy being a naked PUT or CALL.

https://www.investopedia.com/terms/m/multilegorder.asp#:~:text=A%20multi%2Dleg%20options%20order%20is%20used%20to%20enter%20complex,%2C%20ratio%20spread%2C%20and%20butterfly.

A simple and  very visual article that shows what strategies you can build with 4 legs
https://panoptic.xyz/research/essential-options-strategies-to-know#put-%EF%B8%8F


[12/03/2023 14:16] minh___
sweet, thank you!


[12/03/2023 15:22] 0xhacksmithh
I know i'm late, can anyone guide me what does it mean by `Wraps up to 4-legged Uniswap V3 positions in the ERC1155 non-fungible token`


[12/03/2023 17:19] lsaudit
https://github.com/code-423n4/2023-11-panoptic/blob/f75d07c345fd795f907385868c39bafcd6a56624/contracts/libraries/PanopticMath.sol#L172   why this number?


[12/03/2023 20:28] dyedm1
Because to calculate in full precision, you have to square the sqrtPrice before using it ((sqrtPx96*sqrtPx96 = Px192)). At some point though (at the tick specified) this number exceeds the maximum 256-bit unsigned integer, so we have to lower the precision by 64 bits so the calculation doesn't overflow


[12/03/2023 20:37] taylorwebb
@dyed | Panoptic Why are there the token transfer requirements that the entire balance must be sent, and the receiver must have a zero balance?


[12/03/2023 20:44] peakycryptos
Started a thread.


[12/03/2023 20:47] peakycryptos
Started a thread.


[12/03/2023 20:49] peakycryptos
Started a thread.


[12/03/2023 21:31] gladita
There are internal functions afterTokenTransfer (one for single, one for batch) that update Panoptic's state following transfer of SF tokens, but no other functions call these functions. Are these intended to be called by keepers?


[12/03/2023 21:50] dyedm1
There's a lot of per-chunk tracking logic and variables that are nontrivial to update on partial transfers (and may result in unexpected consequences). Thus, we only allow simple transfers where the entire chunk is moved to an empty account (of that chunk.

{Reactions}
üëç 

[12/03/2023 21:51] dyedm1
They're overrides of functions in the ERC1155 implementation that get called on transfer


[12/04/2023 00:23] roleengineer
Proposal to extend contest deadline.

As i had time only on a weekend this week, i spent 2 days only to smoke the code. Codebase is very solid and one of the best in terms of readability, i have reviewed. Explanation blocks in code are awesome.
The complexity of codebase is very high. 
I have couple of ideas i would like to test, but i have only one day for that, which will result in low amount and quality of findings, if any.
IMO, a week for such complex code is not enough, we must read all the code (quite a lot of lines), understand it (not the easiest one) and try to find weak points (no time left), even OZ is still struggling üòÅ I think it is in interest of a team to get more qualified result of a contest.

I propose to make a wardens poll on this post, if you are for deadline extension press üëç, if you are against press üëé .

I propose team and judges to make their decision based on a poll results.

{Reactions}
üëç (12) üëé (11) 

[12/04/2023 00:42] gladita
I agree that the codebase is very well documented and the explanations are very helpful, but I also feel like the time isn't sufficient to really dig in. And I started about 5 days ago


[12/04/2023 02:05] fulum
For sure I don't know if it's feasible but imo it can improve a lot the final results of the contest


[12/04/2023 02:17] cryptor9119
I don't think the codebase is that complex; it's just very good. Sponsors thought a lot about potential vulnerabilities


[12/04/2023 03:06] gladita
Ultimately it's up to the sponsors and what their needs and timelines are, but I think they would get better results with more time


[12/04/2023 13:03] thenpuli
Hi @dyed | Panoptic I dm you.


[12/04/2023 13:23] rouhsamad
Hey @dyed | Panoptic , i dmed you, please check


[12/04/2023 14:08] gladita
all QA/low findings have to be in one report, correct?


[12/04/2023 14:18] fulum
Yes


[12/04/2023 14:26] seaton0x1
So, is it now postponed for 7 days?

{Reactions}
üëç 

[12/04/2023 14:30] gladita
where did it say that? that would help tremendously


[12/04/2023 14:31] devanas17
yep, you can check on code4arena


[12/04/2023 14:31] gladita
oh yes i see it online


[12/04/2023 14:31] gladita
nvm


[12/04/2023 14:31] gladita
i was busy trying to submit my stuff üòÇ


[12/04/2023 14:32] bulletprime.
Likee i just saw it too üòÇ


[12/04/2023 14:46] knownfactc4_29311 (pinned)
Attention @üê∫wardens, the close for this audit has been extended for a week. The new closing date is 12/11/2023 20:00.

{Reactions}
10_10 (15) chefskiss (7) hi5 (8) üëç (12) üá≥üá¨ (3) 

[12/04/2023 14:46] knownfactc4_29311
Pinned a message.


[12/04/2023 14:47] antonttc
yooo sick!


[12/04/2023 14:50] osmanozdemir1
That is quite unprofessional to be honest.

In the last day, just a few hours remaining.

We arrange our schedules based on the dates. If we knew that we could check other contests instead of working hard to squeeze as much as possible in the timeframe. 

The ones who don‚Äôt think time was not enough should have started the contest 7 days ago instead of just looking in the weekend

{Reactions}
üëç (35) 

[12/04/2023 14:54] tx.origin
While I do agree that its unprofessional we're all happy in the end if more bugs are found because of this extra week

{Reactions}
üëç (2) 

[12/04/2023 14:55] d_auditor
I agree with @0xraion Since the purpose of the audit is to uncover the most amount of bugs possible. A few extra days wont hurt

{Reactions}
üëç (2) 

[12/04/2023 14:55] olanre_waju
This is the most important issue here actually. for the dev team, it's more value


[12/04/2023 14:56] 0xpkhatri
Great decision because this contest required extra time

{Reactions}
üëç (3) 

[12/04/2023 14:57] osmanozdemir1
There will also be a second contest. 
And just be honest please. It‚Äôs not about they get more bugs, it‚Äôs about you may have more time to find bugs

{Reactions}
üëç (2) üòÇ 

[12/04/2023 14:59] pfapostol
I left this competition 4 days ago, realizing that there would not be enough time until the end, but now it has lasted for a week, in the last hours...
It's just not a good thing to do....

{Reactions}
‚úÖ (9) 

[12/04/2023 15:00] guy_in0xnito
Hi @dyed | Panoptic  i dm 'd you can you please kindly check


[12/04/2023 15:01] oxtenma
Thank You. This contest requires more time.


[12/04/2023 15:02] 0xding99ya
I would just say close the contest today, mitigate the bugs found this time, then open a mitigation review contest later.

{Reactions}
üëç (8) 

[12/04/2023 15:08] omoaka10
Hello guys
I'm glad to here


[12/04/2023 15:11] minh___
that would require the pot to shrink for this contest


[12/04/2023 15:13] plamkata
Mitigation reviews have  a seperate pot. Also it is stated that the contest would have an update shortly afterwards, so yeah the extension is kinda mitigated either way


[12/04/2023 15:13] 0xding99ya
Yeah I think maybe split the pot. I know the sponsor intention is to give more time to find bugs, but this is the last day, many auditors found this is a complex and already left, give them one more week to start from scratch has no help. Also those who decide to participate may shift to other contest, so I will say the extension probably can‚Äôt achieve sponsors goal

{Reactions}
üëç (5) 

[12/04/2023 15:17] minh___
I disagree with that take, that is double the time thats been given.

Not saying I agree with how its been done, but pretty sure, it can not be detrimental to the findings amount/quality


[12/04/2023 15:18] engr.pips
Maybe It's because i am a beginner auditor though but honestly this codebase is too complicated for a one week review at least for me lol


[12/04/2023 15:21] omoaka10
I'm just here but don't even understood shit about any audit is there a document I can read


[12/04/2023 15:21] engr.pips
Do you mean you don't understand the protocol or you don't even know what a code review is ?


[12/04/2023 15:23] taner2344
He is right. You delay a lot of meeting and adjusting your time according to deadline, at the end  they add one extra  week. Can they pay us for what we have lost?


[12/04/2023 15:26] minh___
you are participating in a free contest, where you can earn money. You dont have obligations to them and they dont have any to you, dont be so entitled

{Reactions}
‚ûï (7) 10_10 

[12/04/2023 15:28] ivand5690
I found something an hour ago and got excited that it is within the timeframe, now with the extended week I don`t know should I be happy because more time might lead to more vulnerabilities or sad because I assume others will find it too if not already. ü§£

{Reactions}
üòÇ 

[12/04/2023 15:28] 10xhash
what is the reason for this?


[12/04/2023 15:28] roleengineer
I really appreciate that wardens are being heard by team and judges. Thanks for your decision üôè.

Poll shows that we are divided almost equally. I can understand those, who worked hard and are ready to submit today. Nothing stops you to do that and switch to another contest. Obviously, the probability that rewards for your findings could decrease is higher now, but you have to agree that this contest is really interesting and it was worth to spend time on it.

Those who supported deadline extension, we have to work hard now and do our best to prove that made decision is correct. Let's go!


[12/04/2023 15:29] qwertypark
Poll with 22 voters?

{Reactions}
üëç (2) 

[12/04/2023 15:31] gr34t.l4k3
Lmao i thought it just a joke, now admin really extended it

{Reactions}
üòÑ (2) 

[12/04/2023 15:31] 0xhelium
The guy that requested extra week should score top in this contest either way do not pay him a dime


[12/04/2023 15:32] qwertypark
Anyway, I think if it has been requested by Panoptic, that's totally fine. But it would be nice to get this information not in the last 5-4 hours to have some space for time management.

If it's requested by wardens, I didn't know that we have such power.


[12/04/2023 15:32] cryptor9119
I agree. The smart play for those who started from day 1 would be to jump on shell or Oympus on sherlock and then maybe comeback to this.

This is a bail out for those who started last min and were shocked that a 1.5K SOLC contest wasn't easy


[12/04/2023 15:34] 0xhelium
Consider a scenario where wardens will always request extra time for all upcoming audits. Will you achieve your forecasted goal in the end of the year ?


[12/04/2023 15:35] osmanozdemir1
The ones who stick with this contest missed the opportunity to participate in Shell


[12/04/2023 15:36] 0xhelium
I support this as fellows 27 wardens who agreed by reacting. Contest should close today


[12/04/2023 15:37] cryptor9119
There are 3 more days for Shell


[12/04/2023 15:38] 0xhelium
Should we go and request more time there also ?


[12/04/2023 15:38] 0xsorrynotsorry
Trivial proposal: Let the Shell contest extend for a week

{Reactions}
üòÇ (4) 

[12/04/2023 15:39] osmanozdemir1
No, its not enough üòÑ


[12/04/2023 15:39] osmanozdemir1
Ahhhhahahaha nice proposal üòÑüòÑ

{Reactions}
ü´° 

[12/04/2023 15:40] gr34t.l4k3
Good idea, i will make a proposal to extend any contest till i found at least 6 high and 9 medium

{Reactions}
üòÇ (3) 

[12/04/2023 15:40] cryptor9119
That depends if I don't find something in the first 24 hours üòÜ


[12/04/2023 15:40] 0xhelium
I will always support you

{Reactions}
üëç 

[12/04/2023 15:41] bluesky_hope_01029
let's vote again

{Reactions}
üëç (4) 

[12/04/2023 15:42] oxtenma
I don't think wardens can request for extension. It is probably protocol team decision with C4.

{Reactions}
üëç (2) 

[12/04/2023 15:42] 0xhelium
Is roleengineer part of sponsor team ?

{Reactions}
üëé 

[12/04/2023 15:43] 0xhelium
Answer this question


[12/04/2023 15:43] roleengineer
no. i'm warden.


[12/04/2023 15:43] 0xhelium
As you can see he is not sponsor

{Reactions}
‚ùì (2) 

[12/04/2023 15:47] 0xsorrynotsorry
They can request, it has happened before, but there's no guarantee that it will be accepted.

{Reactions}
üëç 

[12/04/2023 15:50] adeolu
If they really wanted to participate in shell they should have started shell days ago üòÄ


[12/04/2023 15:52] osmanozdemir1
Yes that‚Äôs what I‚Äôm saying. If a warden knew this contest would take 2 weeks, that person could‚Äôve start the shell 5 days ago, finish it and move to the panoptic since there would be still more than 1 week left for panoptic


[12/04/2023 15:53] 0xdice91
Gotten ur wishüòÑ...christmas came early for you


[12/04/2023 15:53] adeolu
Yes. I agree with you

{Reactions}
ü´° 

[12/04/2023 15:53] rouhsamad
Is it possible to create a vote again, if the decision is made by wardens there are wardens that were not aware of the proposal


[12/04/2023 15:54] 0xsorrynotsorry
Hey, this is not something official, for the records, I'm not part of the C4 team, these type of things should be addressed directly to the  team ü´°

{Reactions}
üëç (2) 

[12/04/2023 15:54] rouhsamad
tbh never thought that would work haha

{Reactions}
üòÑ 

[12/04/2023 15:58] lourenslinde
The pot size is balanced with the contest duration to incentivize participation from wardens.

Here some wardens indicated that they are willing to spend more time without an increased pot; it's a no-brainer for the protocol to extend at the same base cost.

We compete to provide a service to the sponsor at the end of the day. This is likely to lead to a better service, it can't lead to a poorer outcome.

{Reactions}
üëç (2) 

[12/04/2023 16:00] sockdrawermoney
Hey all. I‚Äôm gonna take responsibility for the messiness of this one. 

In extending the deadline at such a late point, staff are acting on some outdated policies.

Please standby and we‚Äôll have an update on this later today.

{Reactions}
code4rena (9) ü´° (5) 

[12/04/2023 16:00] omoaka10
Both
I just understand we need to review audit code


[12/04/2023 16:02] manchasss.eth
Wardens should stop the drama and start using the time extension to audit. Shell, panoptic or whatever but go audit and stop spamming the channel

{Reactions}
üëç (8) 

[12/04/2023 16:06] cryptor9119
The problem is that there will more submissions, longer turnarounds, and diluted rewards. This was decided last min so now is the time to speak up


[12/04/2023 16:09] 0xhelium
Yes this is the major problem. Since it's a competition it's unfair to extend deadline because someone did not have time to compete. Full stop


[12/04/2023 16:13] sockdrawermoney
Further discussion on this isn‚Äôt really necessary. I‚Äôm pretty aware of all of the cases and counter cases.


[12/04/2023 16:13] sockdrawermoney
Just stand by and we‚Äôll have an update

{Reactions}
code4rena (11) üçª (8) üëë 

[12/04/2023 18:10] sockdrawermoney (pinned)
As I mentioned, I take responsibility here for us not having a policy in place.

Many months ago, there was an audit we extended late based on what was presumed to be general consensus among sponsors and wardens. Based on conversations I had at that time with wardens, I came to see it differently. 

How I look at it now is this:

A marathon race is ending. The top people have paced themselves perfectly for the distance and are sprinting for the tape. Then as they‚Äôre about to finish, they find out they have to go another half-marathon! Not great.

Unfortunately I didn‚Äôt communicate that change of perspective to staff and we did not formally modify our internal policy.

We‚Äôre not going to go back on the offer to extend the timeline to the sponsor‚Äîthat wouldn‚Äôt be appropriate now that we‚Äôve already agreed to it.

So here‚Äôs what we‚Äôre going to do.

### Updates to policy:
1. An extension may be permitted at the request of sponsors within the first 48h of an audit.
2. Beyond the 48h window, a sponsor may request to extend the timeline by adding more money to the pool.
3. In both cases 1 and 2, staff hold the responsibility for making the determination.

### In this case:
We take responsibility for breaking the fairness of the competition. Based on that:

1. We will indeed extend the audit as announced.
2. We will also add $15k USDC to the pool out of C4‚Äôs pocket based on our oversight.

Thanks for riding with us. Navigating circumstances like this are how we continually get better.

{Reactions}
üôè (10) ‚ù§Ô∏è (28) 10_10 (5) chefskiss (6) üëç (6) üçª (5) 

[12/04/2023 18:16] cryptor9119
Is that 15K more for only H/Ms, or spread out for the other categories?


[12/04/2023 18:24] olanre_waju
Shell Pot is $36k and duration is 8days, why should Paptonic be 7days in the first place?

This argument was not really necessary in the first place, the pot was not proportional to the duration at first, it's only right if it was extended.


[12/04/2023 18:27] itsmetechjay
Pinned a message.


[12/04/2023 18:47] 0xciphky
The main issue is extending the deadline just a few hours before the contest was supposed to end. This is a problem because many of us have other audits (private/with firms) scheduled and can't change our schedules at the last minute. Adding more money to the prize doesn't help when others now have twice as much time as we had. I understand this happened because of a mix-up in communication but it‚Äôs still disappointing.


[12/04/2023 19:06] sockdrawermoney
fully understood that it's disappointing but we're not going to renege on the customer after approving their request to extend. we just have to improve for the future.

{Reactions}
üëç (10) 

[12/04/2023 19:07] escrow1337
Lets not make a mountain out of a molehill üòõ

Errors happen; no system or policy is truly perfect and regardless, Sock cleared it up and apologised for the error, as well as adding $15k to the overall pot. For a timeline error, that's actually really generous. Don't take it for granted and carry on grinding. Sure, some people have things lined up with their own personal timeline and that can be a disadvantage for them, but think about those who are not as fortunate and therefore it can be an advantage for them. Not everybody has the same opportunities, whether it's in security or IRL. 

Perspective is everything.

{Reactions}
üëÜ (18) üíú (10) 

[12/04/2023 19:10] sockdrawermoney
it's important to understand that most of the time the lengths and timelines are based on what works for the customer. no customer, no audit. taken entirely from the warden perspective it's easy to see what would be presumably consistent or fair, but there are always more moving pieces involved.

{Reactions}
üëç (11) 

[12/04/2023 20:25] bytes032
the best take so far

{Reactions}
üëç (6) 

[12/04/2023 23:32] taylorwebb
how the swap is done, and this comment is confusing to me. Wouldn't we need to swap the tokens first to get the correct ratio of token0/token1, and then deploy them to the AMM?


[12/04/2023 23:33] taylorwebb


{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/image-024F6.png


[12/05/2023 00:02] taylorwebb
ok, so I think my understanding now is that it is assumed that the msg.sender has the correct amounts of token0/token1 already (or excess of each), and the `swapInAMM` function is used after AMM LP is added to replenish whichever of the tokens did have itm amounts. lmk if this is accurate


[12/05/2023 00:04] dyedm1
Yes, that's it

{Reactions}
üôè (2) 

[12/05/2023 02:38] 0xfave
@dyed | Panoptic when transferring your token all balances must be sent including the liquidity chunk?


[12/05/2023 02:54] dyedm1
not necessarily all balance but all liquidity


[12/05/2023 10:57] plamkata
Liquidity chunks track per leg per tokenId liquidity, so users using the same tokenId for transactions would move the same chunk?


[12/05/2023 11:14] audinarey
Hi @PeakyCryptos | Panoptic I have pending DMs in your inbox

{Reactions}
üëç 

[12/06/2023 12:02] kris_renzo
I just noticed the time extension. Since I already switched to other activities, I thought to share some of the invariants I had planned to test. Hopefully, it adds value to the community. After all, the end goal is a win for the space as a whole.
[Link here](https://github.com/Renzo1/All-About-Invariants-Formulation/tree/main)

{Embed}
https://github.com/Renzo1/All-About-Invariants-Formulation/tree/main
GitHub - Renzo1/All-About-Invariants-Formulation
Contribute to Renzo1/All-About-Invariants-Formulation development by creating an account on GitHub.
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/All-About-Invariants-Formulation-DC798

{Reactions}
ü§ù (16) 

[12/06/2023 12:16] nican0r
@dyed | Panoptic what's the difference between `feeBase` and `accountPremium`? Seems like they're both accumulating fees that the liquidity in a pool earns, is the primary difference that `accountPremium` accounts for liquidity that's been removed?


[12/06/2023 12:53] sweetcat0118
So Cool

{Reactions}
üëçüèæ 

[12/06/2023 15:43] gladita
But I didn't submit everything by Dec 4 because I saw that it was extended and now people are trying to say it shouldn't be extended?


[12/06/2023 15:53] minh___
no worries, it got extended, there was just a bit of an argument on how it has been handled


[12/06/2023 16:15] dyedm1
Yes


[12/06/2023 16:16] dyedm1
Yes. Also, `accountPremium` includes a multiplier for the removed premium based on liquidity utilization

{Reactions}
üëç 

[12/06/2023 17:03] filmptz
@dyed | Panoptic Am I correct in understanding that if `tokenType` is set to 0, it means the `token0` is moved and it  implies as a `CALL` option?


[12/06/2023 17:05] dyedm1
Whether it is a call or a put depends on what token0 actually is. In the SFPM, if tokenType is set to 0 and swapping is enabled, token0 will be swapped for any token1 used to mint a short position, and any token1 received from a long position will be swapped to token0

{Reactions}
üôè 

[12/06/2023 18:46] fulum
What's the purpose of the positions minted on your ecosystem ? Do they serve any other purpose than to recover liquidity?


[12/06/2023 18:55] dyedm1
Panoptic (built on the SFPM) uses long positions to represent borrowed liquidity

{Reactions}
üëç (4) 

[12/06/2023 19:06] 0xloscar01
Is the left slot of `removedAndNetLiquidity` debt owed to a seller? What does Panoptic do with the `s_accountLiquidity` mapping?


[12/07/2023 14:30] audinarey
@dyed | Panoptic can I send a DM?


[12/07/2023 15:48] dyedm1
It's not debt from the SFPM's perspective, it's just your own liquidity that you have removed. Panoptic does use long/removed liquidity to represent debt in that mapping though.


[12/07/2023 15:48] dyedm1
Sure


[12/08/2023 11:00] plamkata
When a user mints a position via a swap, does he need to do a swap during the burn?


[12/08/2023 14:48] olanre_waju
How can i solve this error please?

{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/image-33CDA.png


[12/08/2023 15:34] audinarey
@dyed | Panoptic Kindly check your DM

{Reactions}
üëç 

[12/08/2023 15:35] lourenslinde
You're trying to fork at an older block number with a public rpc url which doesn't support it.

You can create an endpoint url to use for free at alchemy or infura.


[12/08/2023 16:05] dyedm1
Only if the position is ITM at the time of burn. Whether a swap or mint occured or not does not matter


[12/08/2023 16:24] filmptz
So for the burn case, if the token has itm amount, it should trigger the swap to replenish, Am I right?


[12/08/2023 16:41] dyedm1
Yep

{Reactions}
üôè 

[12/08/2023 18:17] patricksfeir
I'm encountering some issues running slither. I'm using this command: slither SemiFungiblePositionManager.sol --config-file slither.config.json


[12/08/2023 18:19] patricksfeir
how can we run printers


[12/08/2023 18:30] patricksfeir


{Attachments}
Code4rena - ARCHIVE-Q4-2023 - panoptic-nov27 [1176549245935955998].txt_Files/Screenshot_591-D8EA7.png


[12/08/2023 21:39] osmanozdemir1
https://x.com/panoptic_xyz/status/1724536504268230870?s=46&t=nSP_zsbuCU1DFJ5f5GHgDQ

Hi,
Is this still valid or will it be postponed due to the first contest being extended?


[12/09/2023 18:43] dyedm1
No. The new date of the contest has not been announced yet.


[12/09/2023 18:44] osmanozdemir1
Thanks for the info ü´°


[12/10/2023 06:10] filmptz
Hi @dyed | Panoptic pending DM, I have some questions. Can you please kindly check


[12/10/2023 15:00] audinarey
same here


[12/10/2023 18:02] roleengineer
i was dedicated in search this week, but unfortunately was not able to find a bug. i resign. looking forward to see h/m findings, when results will become public. this one was really interesting for me.

{Reactions}
hi5 (2) 

[12/10/2023 20:31] 0xhelium
were you the one who asked for more time for the audit ?


[12/10/2023 20:32] roleengineer
yes.

{Reactions}
üëç 

[12/10/2023 21:29] dyedm1
Sorry, your DM was marked as spam. I see it now :)

{Reactions}
ü•π 

[12/11/2023 14:19] qpzm
What is the meaning of this line? I don't understand why subtracting -movedInLeg in  `receivedAmount0 - uint128(-movedInLeg.rightSlot())`.
> moved will be negative if the leg was long (funds left the caller, don't count it in collected fees)
https://github.com/code-423n4/2023-11-panoptic/blob/main/contracts/SemiFungiblePositionManager.sol#L1230-L1236


[12/11/2023 14:36] filmptz
If I understand correctly, this occurs because, for the `Long` position (burn liquidity) => `moveInLeg amount is negative`, the `positionOwed` from AMM includes the burnt amount from the burn liquidity process. 
Therefore, it should be subtracted by the `moveInLeg` amount to collect only the fee.

{Reactions}
üëç (3) 

[12/11/2023 15:20] qpzm
Oh, I see. The process of stop providing LP is decreaseLiquidity -> collect -> burn.


[12/11/2023 17:34] 10xhash
@dyed | Panoptic Hey, pls check the private thread

{Reactions}
üëç 

[12/11/2023 20:02] C4
**üö® AUDIT ALERT**

@üê∫wardens The **Panoptic** audit is now closed! Huge thanks to everyone who participated üîç, whether you submitted a finding or not.

What's next: The sponsor team and judge will review the findings over the next couple of weeks. Keep an eye on #üì¢announcements for regular updates on how the audit is progressing through awarding ü§ëüèÜ, judging üßë‚Äç‚öñÔ∏è and reporting üìú. Feel free to ping a Contest-Admin if you have questions along the way!

{Reactions}
‚ù§Ô∏è 

[12/12/2023 09:47] sivanesh_808
Total submissions ?


[12/12/2023 10:14] beirao
600

{Reactions}
‚ù§Ô∏è (4) üî• (6) 

[12/24/2023 14:24] anmol.eth
When final reports will be released?


[12/24/2023 17:52] 0xhelium
I believe they should first anounce rewards


[12/24/2023 17:53] 0xhelium
Then compile the reports


[01/02/2024 14:18] plamkata
:chefskiss:

{Reactions}
code4rena 

[01/05/2024 22:34] _paperparachute
ü§ë üéâ  Awards for **Panoptic**:

$15,331.69 USDC ¬ª @hash 
$9,615.44 USDC ¬ª @0xDING99YA 
$5,503.88 USDC ¬ª @monrel 
$4,233.75 USDC ¬ª @bin2chen 
$4,233.75 USDC ¬ª linmiaomiao 
$2,588.90 USDC ¬ª tapir 
$1,662.48 USDC ¬ª @LokiThe5th 
$1,629.99 USDC ¬ª @osmanozdemir1 
$1,496.39 USDC ¬ª SpicyMeatball 
$1,270.13 USDC ¬ª @kfx 
$1,270.13 USDC ¬ª @lil_eth 
$1,253.84 USDC ¬ª @ether_sky 
$1,130.92 USDC ¬ª fnanni 
$1,122.42 USDC ¬ª @KupiaSec 
$1,122.42 USDC ¬ª @minhtrng 
$1,111.11 USDC ¬ª @0xloscar01 
$1,071.82 USDC ¬ª @sivanesh_808 
$860.57 USDC ¬ª @Sathish9098 
$559.39 USDC ¬ª 0xCiphky 
$479.29 USDC ¬ª @0xHelium 
$479.29 USDC ¬ª @0xSmartContract 
$479.29 USDC ¬ª @catellatech 
$416.66 USDC ¬ª @critical-or-high 
$226.18 USDC ¬ª @0xAnah 
$226.18 USDC ¬ª @JCK 
$219.65 USDC ¬ª Udsen 
$219.65 USDC ¬ª @ptsanev 
$142.73 USDC ¬ª @Cryptor 
$115.48 USDC ¬ª @Topmark 
$115.48 USDC ¬ª @lanrebayode77 
$104.17 USDC ¬ª @Neon2835 
$74.70 USDC ¬ª @K42 Œ® 
$66.20 USDC ¬ª @ZanyBonzy 
$66.20 USDC ¬ª @foxb868 
$54.88 USDC ¬ª @0xAadi 
$54.88 USDC ¬ª @Bulletprime 
$54.88 USDC ¬ª @Raihan 
$54.88 USDC ¬ª @Fouzantanveer 
$54.88 USDC ¬ª @john80 
$19.82 USDC ¬ª @0x6980 
$19.82 USDC ¬ª 0x886699 
$19.82 USDC ¬ª 0xhex 
$19.82 USDC ¬ª 0xta 
$19.82 USDC ¬ª Eurovickk 
$19.82 USDC ¬ª @SAQ 
$19.82 USDC ¬ª SY_S 
$19.82 USDC ¬ª @Alix40 
$19.82 USDC ¬ª @arjun16 
$19.82 USDC ¬ª @naman1778 
$19.82 USDC ¬ª @nisedo 
$19.82 USDC ¬ª @unique 
$11.32 USDC ¬ª @audinarey 
$11.32 USDC ¬ª Banditx0x 
$11.32 USDC ¬ª @CRYP70 
$11.32 USDC ¬ª @D1r3Wolf 
$11.32 USDC ¬ª @Skylice 
$11.32 USDC ¬ª ThenPuli 
$11.32 USDC ¬ª @baice 
$11.32 USDC ¬ª fatherOfBlocks 
$11.32 USDC ¬ª @grearlake 
$11.32 USDC ¬ª @hihen 
$11.32 USDC ¬ª hubble 
$11.32 USDC ¬ª @hunter_w3b 
$11.32 USDC ¬ª @leegh 
$11.32 USDC ¬ª @lsaudit 
$11.32 USDC ¬ª @nocoder 
$11.32 USDC ¬ª onchain-guardians 
$11.32 USDC ¬ª ro1sharkm 
$11.32 USDC ¬ª @seaton0x1 
$11.32 USDC ¬ª @t4sk 
$11.32 USDC ¬ª @tpiliposian 
$11.32 USDC ¬ª @ustas

üèÅ Findings summary
--------------------------------------‚Äî
High risk findings: 2 unique (14 total)
Med risk findings: 5 unique (17 total)
Gas reports: 18 (Best: sivanesh_808)
QA reports: 37 (Best: osmanozdemir1)
Advanced analysis reports: 12 (Best: Sathish9098)

Awards will be distributed on Polygon within the next week. Congratulations all!  üí∏ üí∏ üí∏

*Note: If you participated in this audit and don‚Äôt see your name on this list, please wait until the report is published and the findings repo is made public to check on your submissions.*

{Reactions}
üéâ (10) üöÄ (4) 

[01/05/2024 22:42] osmanozdemir1
Congrats everyone üéâ

{Reactions}
üçª (3) hi5 

[01/05/2024 22:44] osmanozdemir1
It was a complex codebase


[01/06/2024 06:07] 0xciphky
Congrats @hash Killed it!

{Reactions}
‚ù§Ô∏è (5) 

[01/06/2024 07:18] alix40
Thanks C4 and Panoptic for the contest. This was my second contest and I have never been so happy for receivng 19 usdc like this before. You totally made my day and gave me extra motivation to step up my game in this space !

{Reactions}
üíú (8) hi5 (4) üöÄ (5) 

[01/06/2024 14:35] ding0077
Congratulations


[02/29/2024 17:28] itsmetechjay
‚ÑπÔ∏è This channel is pending archive.  As a result, any private threads will be permanently deleted on Friday, 08 March 2024. Please make sure to grab anything you might need from those before then.


[03/07/2024 14:35] itsmetechjay
‚ÑπÔ∏è Reminder: this channel will be deleted in 24 hours.


==============================================================
Exported 393 message(s)
==============================================================
